## 浏览器缓存

- 浏览器缓存是为了节约网络的资源加速留蓝球，减少 http 请求次数，浏览器在用户磁盘上对用户最近请求过的文档进行存储，当用户再次请求这个页面时，浏览器就可以从本地磁盘上显示文档。
- 浏览器缓存的使用是提高用户体验的一种方式，也是优化前端的一种方式，可以加快页面的浏览，降低服务器的压力，减少网络的损耗

### 浏览器缓存的过程

- 客户端发送请求到服务端
- 服务端返回资源，并带上标识
- 再次请求相同资源时，带向标识
- 验证通过，响应 304，客户端自动读取缓存

### 浏览器缓存的方法

> 协商缓存

- 过程
  - 客户端向服务器请求资源
  - 验证标识，如果标识通过了验证，则会响应 304，告知浏览器读取缓存
  - 如果没有标识，或验证没有通过，则返回请求的资源
- 标识：主要是用来标识请求的资源是否被修改或更新过，通过请求头发送给服务端进行验证
  > 标识类型
- ETag

```
* ETag的流程和last-Modified是一样的，仅仅只是验证方式不同，last-modified是取当前请求资源的最后修改时间来作为验证，而ETag则是对当前请求的资源做一个唯一的标识
* 标识可以是一个字符串，文件的size,hash等等，只要能够合理标识资源的唯一性并能验证是否修改过了就可以了。比如读取文件内容，将文件内容转换成一个Hash值，每次接收到客户端发送过来的时候，重新读取文件转成hash值，与之前的做对比，看资源是否修改过
* 和Last-Modify相同，服务器响应头返回一个ETag字段，那么请求的时候就会在请求头中加入if-none-match
```

- Last-Modified

```
* last-modified根据词义就知道表示该资源的最后修改时间
* 过程
（1）客户端第一次请求服务器，服务器会把资源的最后修改时间通过响应头返回给客户端
（2）客户端再次请求服务端的时候，如果在响应头中有Last-Modified字段，浏览器就会在就会在请求头中加上if-Modified-Since字段给浏览器
（3）服务器拿到该字段的值，与该资源的最后修改时间进行对比，如果相等则说明资源没有修改，想客户端返回304
(4)浏览器看到304就会去读取缓存信息并呈现
```

> 强缓存

- 简介

```
强制缓存就是想浏览器设置一个过期时间，例如cache-control:max-age=60表示这是一个60秒的过期时间，60以内浏览器都会从缓存读取该资源，超过60秒则访问服务器
cache-control的其他值：
* private 客户端可以缓存
* pubLic 客户端和代理服务器都可以缓存
* max-age=60 缓存内容将在60秒后失效
* no-cache 需要使用对比缓存验证数据，强制向源服务器再次验证
* no-store 所有内容都不会缓存，强制缓存和对比缓存都不会触发
```

- 过程

```
* 强制缓存通过Cache-Control这个响应头中的max-age:60(缓存60s)来判断缓存是否过期
* 如果过期了则重新向服务器请求资源
* 如果没有过期，则不经过服务器，直接读取资源
```
